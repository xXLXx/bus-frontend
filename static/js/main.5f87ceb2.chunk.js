(this["webpackJsonpbus-frontend"]=this["webpackJsonpbus-frontend"]||[]).push([[0],{42:function(e,t,n){},63:function(e,t,n){},64:function(e,t,n){},71:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"getBusStops",(function(){return B})),n.d(r,"getBusStopsSuccess",(function(){return L})),n.d(r,"getBusStopsFailure",(function(){return P})),n.d(r,"setBusStopsFilter",(function(){return I})),n.d(r,"setSelectedBusStop",(function(){return _})),n.d(r,"getBusStop",(function(){return T})),n.d(r,"getBusStopSuccess",(function(){return U})),n.d(r,"getBusStopFailure",(function(){return F}));var a=n(0),c=n.n(a),s=n(15),o=n.n(s),i=(n(42),n(21)),u=n(3),l=n(4),d=n.n(l),p=n(10),b=n(12),f=n(2),j={maps:{apiKey:"AIzaSyAOkWHdgDnu-Gvc5r8LZcp7f6Vrlnge_rw",defaultCenter:{lat:-34.397,lng:150.644},defaultZoom:15},api:{baseUrl:"https://fz05347cj8.execute-api.eu-central-1.amazonaws.com/development/api/v1/",apiKey:"sNmw182PIBRze8DGeMt9zViN7l9lUCmqpd89RKjip39Y6-wNhVctjtpzXM6gl3j7"},store:{debug:!1}},O=function(e){return Object.keys(e).reduce((function(t,n){return"".concat(t).concat(t?"&":"").concat(n,"=").concat(encodeURIComponent(e[n]))}),"")},v=n(24),g="BUS_STOPS_FETCH",h="BUS_STOPS_FETCH_SUCCESS",S="BUS_STOPS_FETCH_FAILURE",x="BUS_STOPS_FILTER",m="BUS_STOP_SET_SELECTED",y="BUS_STOP_FETCH",w="BUS_STOP_FETCH_SUCCESS",C="BUS_STOP_FETCH_FAILURE",k={busStops:[],filters:{},isLoading:!1,isLastPage:!1,errorMessage:"",selectedBusStop:null,selectedBusStopIndex:-1},E=function(e){var t={};for(var n in e){var r;t[n]=null===(r=e[n])||void 0===r?void 0:r.initialState}return{initialState:t,reducer:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,r=arguments.length>1?arguments[1]:void 0,a=Object(f.a)({},n);for(var c in j.store.debug&&console.info("Action ".concat(r.type,": %O"),JSON.parse(JSON.stringify(r))),e)e[c].reducer&&(a[c]=e[c].reducer(n[c],r));return j.store.debug&&console.info("State ".concat(r.type,": %O"),JSON.parse(JSON.stringify(a))),Object(f.a)({},a)}}}({busStops:{initialState:k,reducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case g:return Object(f.a)(Object(f.a)({},e),{},{isLoading:!0,errorMessage:""});case h:var n=t.payload;return Object(f.a)(Object(f.a)({},e),{},{busStops:[].concat(Object(v.a)(e.busStops),Object(v.a)((null===n||void 0===n?void 0:n.data)||[])),isLoading:!1,isLastPage:(null===n||void 0===n?void 0:n.isLastPage)||e.isLastPage});case S:return Object(f.a)(Object(f.a)({},e),{},{busStops:[],isLoading:!1,errorMessage:t.payload});case x:var r=t.payload,a=r.reset,c=r.filters,s=void 0===c?{}:c;return Object(f.a)(Object(f.a)({},e),{},{busStops:a?[]:e.busStops,isLastPage:!a&&e.isLastPage,filters:s});case m:return Object(f.a)(Object(f.a)({},e),{},{selectedBusStop:Object(f.a)({},e.busStops[t.payload]),selectedBusStopIndex:t.payload});case y:return Object(f.a)(Object(f.a)({},e),{},{isLoading:!0,errorMessage:""});case w:var o=t.payload,i=e.busStops,u=e.selectedBusStopIndex,l=u>=0&&void 0!==(null===o||void 0===o?void 0:o.data);return l&&(i[u]=Object(f.a)(Object(f.a)({},i[u]),{},{details:Object(f.a)({},o.data)})),Object(f.a)(Object(f.a)({},e),{},{busStops:i,isLoading:!1,selectedBusStop:l?i[u]:e.selectedBusStop,selectedBusStopIndex:u});case C:return Object(f.a)(Object(f.a)({},e),{},{isLoading:!1,errorMessage:t.payload});default:return Object(f.a)({},e)}}}}),B=function(e){return{type:g,payload:e}},L=function(e){var t=e.data,n=e.isLastPage;return{type:h,payload:{data:t,isLastPage:void 0!==n&&n}}},P=function(e){return{type:S,payload:e}},I=function(e){var t=e.filters,n=e.reset;return{type:x,payload:{filters:t,reset:void 0!==n&&n}}},_=function(e){return{type:m,payload:e}},T=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:y,payload:{byId:e,reset:t}}},U=function(e){var t=e.data;return{type:w,payload:{data:t}}},F=function(e){return{type:C,payload:e}},N=n(34),M=n.n(N).a.create({baseURL:j.api.baseUrl,timeout:3e4,headers:{"X-Api-Key":j.api.apiKey}}),R=function(){var e=Object(p.a)(d.a.mark((function e(t,n){var r,a,c,s,o,i=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:{},e.prev=1,e.next=4,M[t](n,r);case 4:if(a=e.sent,!(c=a.data).success){e.next=10;break}return e.abrupt("return",c.data);case 10:throw new Error(c.message||"An unknown error occured.");case 11:e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(1),o=e.t0.response,new Error((null===o||void 0===o||null===(s=o.data)||void 0===s?void 0:s.message)||"An unknown error occured.");case 17:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t,n){return e.apply(this,arguments)}}(),z=function(){var e=Object(p.a)(d.a.mark((function e(t,n,r){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next=e.t0===g?3:e.t0===y?6:9;break;case 3:return e.next=5,A(r,t,n);case 5:return e.abrupt("break",9);case 6:return e.next=8,H(r,t,n);case 8:return e.abrupt("break",9);case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),A=function(){var e=Object(p.a)(d.a.mark((function e(t,n,r){var a,c,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=r.busStops).isLastPage){e.next=5;break}t(L({})),e.next=16;break;case 5:return e.prev=5,c=!0,e.next=9,R("get","bus-stops?".concat(O(a.filters)));case 9:s=e.sent,t(L({data:s,isLastPage:c})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),t(P(e.t0.message));case 16:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t,n,r){return e.apply(this,arguments)}}(),H=function(){var e=Object(p.a)(d.a.mark((function e(t,n,r){var a,c,s,o,i,u,l,p;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.busStops,c=a.busStops,s=a.selectedBusStopIndex,o=n.payload,i=o.byId,u=o.reset,l=i&&c.busStops.findIndex((function(e){return e.id===i}))||s,c[l]){e.next=13;break}if(!i){e.next=12;break}return t(L([{id:i}])),t(_(c.length-1)),e.next=9,H(t,n,r);case 9:return e.abrupt("return",e.sent);case 12:throw new Error("No way to determine a bus stop without an id or index");case 13:if(void 0!==c[l].details&&!u){e.next=26;break}return e.prev=14,e.next=17,R("get","bus-stops/".concat(encodeURIComponent(c[l].id)));case 17:p=e.sent,t(U({data:p,index:l})),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),t(F(e.t0.message));case 24:e.next=27;break;case 26:t(U({}));case 27:case"end":return e.stop()}}),e,null,[[14,21]])})));return function(t,n,r){return e.apply(this,arguments)}}(),K=[z],J=n(1),D=Object(a.createContext)(),V=function(e){var t=e.children,n=E.initialState,c=E.reducer,s=Object(a.useReducer)(c,n),o=Object(b.a)(s,2),i=o[0],u=o[1],l=Object(a.useRef)([]),f=function(e,t){return function(){var n=Object(p.a)(d.a.mark((function n(r){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.current.push(r),t(r);case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}(l,u),O=function(e,t){var n={},r=function(r){n[r]=function(n){t(e[r](n))}};for(var a in e)r(a);return n}(r,f),v=Object(a.useCallback)(Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((null===l||void 0===l?void 0:l.current)&&(null===l||void 0===l?void 0:l.current.length)>=1)){e.next=6;break}return t=l.current.splice(0,1)[0],j.store.debug&&console.info("Saga ".concat(t.type)),e.next=5,Promise.all(K.map((function(e){return e(t,i,f)})));case 5:v();case 6:case"end":return e.stop()}}),e)}))),[f,i]);return Object(a.useEffect)((function(){v()}),[i,v]),Object(J.jsx)(D.Provider,{value:{state:i,actions:O},children:t})},W=function(e){var t=e.children;return Object(J.jsx)("div",{className:"main-wrapper",children:t})},X=n(14),Y=(n(63),n(35));n(64);function Z(){return(Z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function G(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var q=a.createElement("g",{transform:"translate(50 50)"},a.createElement("g",{transform:"scale(0.8)"},a.createElement("g",{transform:"translate(-50 -50)"},a.createElement("g",null,a.createElement("animateTransform",{attributeName:"transform",type:"translate",repeatCount:"indefinite",dur:"1s",values:"-20 -20;20 -20;0 20;-20 -20",keyTimes:"0;0.33;0.66;1"}),a.createElement("path",{fill:"#ebfffe",d:"M44.19 26.158c-4.817 0-9.345 1.876-12.751 5.282c-3.406 3.406-5.282 7.934-5.282 12.751 c0 4.817 1.876 9.345 5.282 12.751c3.406 3.406 7.934 5.282 12.751 5.282s9.345-1.876 12.751-5.282 c3.406-3.406 5.282-7.934 5.282-12.751c0-4.817-1.876-9.345-5.282-12.751C53.536 28.033 49.007 26.158 44.19 26.158z"}),a.createElement("path",{fill:"#7d7d7d",d:"M78.712 72.492L67.593 61.373l-3.475-3.475c1.621-2.352 2.779-4.926 3.475-7.596c1.044-4.008 1.044-8.23 0-12.238 c-1.048-4.022-3.146-7.827-6.297-10.979C56.572 22.362 50.381 20 44.19 20C38 20 31.809 22.362 27.085 27.085 c-9.447 9.447-9.447 24.763 0 34.21C31.809 66.019 38 68.381 44.19 68.381c4.798 0 9.593-1.425 13.708-4.262l9.695 9.695 l4.899 4.899C73.351 79.571 74.476 80 75.602 80s2.251-0.429 3.11-1.288C80.429 76.994 80.429 74.209 78.712 72.492z M56.942 56.942 c-3.406 3.406-7.934 5.282-12.751 5.282s-9.345-1.876-12.751-5.282c-3.406-3.406-5.282-7.934-5.282-12.751 c0-4.817 1.876-9.345 5.282-12.751c3.406-3.406 7.934-5.282 12.751-5.282c4.817 0 9.345 1.876 12.751 5.282 c3.406 3.406 5.282 7.934 5.282 12.751C62.223 49.007 60.347 53.536 56.942 56.942z"})))));function Q(e,t){var n=e.title,r=e.titleId,c=G(e,["title","titleId"]);return a.createElement("svg",Z({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",style:{margin:"auto",background:"none",display:"block",shapeRendering:"auto"},width:"200px",height:"200px",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",ref:t,"aria-labelledby":r},c),n?a.createElement("title",{id:r},n):null,q)}var $=a.forwardRef(Q),ee=(n.p,function(e){var t=e.fixed,n=e.absolute;return Object(J.jsx)("span",{className:Object(Y.a)("loader-wrapper",{fixed:t,absolute:n}),children:Object(J.jsx)($,{})})}),te=Object(a.memo)(ee),ne=n(36),re=n.n(ne),ae=function(e){var t=e.busStopIndex,n=e.onInfoChanged,r=Object(a.useContext)(D),c=r.state,s=r.actions,o=s.setSelectedBusStop,i=s.getBusStop,u=c.busStops,l=u.busStops,d=u.selectedBusStopIndex,p=l[t],b=Object(a.useCallback)((function(){var e;return p?Object(J.jsxs)("div",{className:"bus-stop-detail-wrapper",children:[Object(J.jsx)("h3",{children:p.name}),Object(J.jsx)("ul",{children:((null===(e=p.details)||void 0===e?void 0:e.nextArrivals)||[]).map((function(e,t){var n,r=e.time.split(":"),a=re()().utc();a.date(a.date()+(e.day-a.day())),a.hours(Number(r[0])),a.minutes(Number(r[1]));var c=a.local();return Object(J.jsxs)("li",{children:[Object(J.jsx)("strong",{children:null===(n=e.bus)||void 0===n?void 0:n.name}),": ",c.format("h:mm a")," (",c.from(new Date),")"]},t)}))})]}):Object(J.jsx)("h3",{children:"We cannot find that bus stop."})}),[p]),f=Object(a.useCallback)((function(){o(t),i()}),[t,o,i]);return Object(a.useEffect)((function(){d===t&&n({position:p.position,options:{pixelOffset:{height:-50,width:0}},info:p?b():Object(J.jsx)("h3",{children:"Sorry! we cannot find that bus stop."})})}),[p,n,d,t,b]),Object(J.jsx)("div",{children:Object(J.jsx)(X.d,{position:p.position,onClick:f})})},ce=function(){var e=Object(a.useContext)(D),t=e.state,n=e.actions,r=n.setBusStopsFilter,c=n.getBusStops,s=t.busStops,o=s.busStops,i=s.errorMessage,u=s.isLoading,l=Object(a.useRef)(null),f=Object(a.useRef)(!1),O=Object(a.useState)(null),v=Object(b.a)(O,2),g=v[0],h=v[1],S=Object(a.useState)({}),x=Object(b.a)(S,2),m=x[0],y=x[1],w=Object(a.useState)(null),C=Object(b.a)(w,2),k=C[0],E=C[1],B=Object(a.useState)(!1),L=Object(b.a)(B,2),P=L[0],I=L[1],_=Object(a.useState)(null),T=Object(b.a)(_,2),U=T[0],F=T[1],N=Object(a.useState)(j.maps.defaultCenter),M=Object(b.a)(N,2),R=M[0],z=M[1],A=Object(X.e)({id:"bus-stops-map",googleMapsApiKey:j.maps.apiKey}).isLoaded;Object(a.useEffect)((function(){return H(),K(),window.addEventListener("resize",H),function(){window.removeEventListener("resize",H)}}),[]),Object(a.useEffect)((function(){g&&k&&!f.current&&(f.current=!0,r({filters:{near:"".concat(k.lat,",").concat(k.lng)},reset:!0}),c(),g.setCenter(k))}),[k,g,r,c]);var H=function(){y({width:"".concat(window.innerWidth,"px"),height:"".concat(window.innerHeight,"px")})},K=function(){var e=Object(p.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new Promise((function(e,t){navigator.geolocation?navigator.geolocation.getCurrentPosition(e,t):t(new Error("Your browser doesn't support geolocation."))}));case 3:t=e.sent,n=t.coords,E({lat:n.latitude,lng:n.longitude}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),E(j.maps.defaultCenter);case 11:return e.prev=11,I(!0),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,8,11,14]])})));return function(){return e.apply(this,arguments)}}(),V=Object(a.useCallback)((function(e){h(e)}),[h]),W=Object(a.useCallback)((function(){h(null)}),[h]),Y=Object(a.useCallback)((function(){if(g){var e=g.getCenter();z({lat:e.lat(),lng:e.lng()})}}),[z,g]),Z=Object(a.useCallback)((function(e){(null===l||void 0===l?void 0:l.current)&&g&&l.current.open(g),F(e)}),[F,g]);return A?Object(J.jsxs)("div",{className:"bus-stops-map-wrapper",children:[(u||!P)&&Object(J.jsx)(te,{absolute:!0}),Object(J.jsxs)(X.a,{mapContainerStyle:m,center:j.maps.defaultCenter,zoom:j.maps.defaultZoom,onLoad:V,onUnmount:W,onCenterChanged:Y,children:[(null===U||void 0===U?void 0:U.position)&&Object(J.jsx)(X.c,{position:U.position,options:U.options||{},onLoad:function(e){return l.current=e},children:(null===U||void 0===U?void 0:U.info)||Object(J.jsx)("div",{className:"info-window-placeholder"})}),o.map((function(e,t){return Object(J.jsx)(ae,{busStopIndex:t,onInfoChanged:Z},t)})),i&&Object(J.jsx)(X.b,{position:R,children:Object(J.jsx)("h1",{className:"error",children:i})})]})]}):Object(J.jsx)(te,{fixed:!0})},se=Object(a.memo)(ce),oe=function(e){var t=e.match;return Object(J.jsx)(u.c,{children:Object(J.jsx)(u.a,{path:"".concat(t.path),component:se})})},ie=function(){return Object(J.jsx)(V,{children:Object(J.jsx)(W,{children:Object(J.jsx)(i.a,{children:Object(J.jsx)(u.c,{children:Object(J.jsx)(u.a,{path:"/",component:oe})})})})})},ue=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,72)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),r(e),a(e),c(e),s(e)}))};o.a.render(Object(J.jsx)(c.a.StrictMode,{children:Object(J.jsx)(ie,{})}),document.getElementById("root")),ue()}},[[71,1,2]]]);
//# sourceMappingURL=main.5f87ceb2.chunk.js.map